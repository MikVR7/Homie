<mxfile host="app.diagrams.net">
  <diagram name="USB Drive System" id="usb-drive">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="900" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- USB Drive Entity -->
        <mxCell id="2" value="«entity»&#xa;USBDrive" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="550" y="40" width="300" height="220" as="geometry" />
        </mxCell>
        <mxCell id="3" value="+ id: INTEGER PRIMARY KEY&#xa;+ user_id: TEXT&#xa;+ drive_path: TEXT (current mount)&#xa;+ drive_type: TEXT = 'usb'&#xa;+ drive_label: TEXT&#xa;+ usb_serial_number: TEXT&#xa;+ partition_uuid: TEXT&#xa;+ identifier_type: TEXT&#xa;+ primary_identifier: TEXT&#xa;+ is_connected: BOOLEAN&#xa;+ last_used: TIMESTAMP&#xa;+ created_at: TIMESTAMP" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="2">
          <mxGeometry y="40" width="300" height="180" as="geometry" />
        </mxCell>
        
        <!-- Drive Identification Strategy -->
        <mxCell id="4" value="«enumeration»&#xa;IdentifierType" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="100" y="40" width="200" height="120" as="geometry" />
        </mxCell>
        <mxCell id="5" value="USB_SERIAL&#xa;PARTITION_UUID&#xa;LABEL_SIZE" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="4">
          <mxGeometry y="40" width="200" height="54" as="geometry" />
        </mxCell>
        <mxCell id="6" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;" vertex="1" parent="4">
          <mxGeometry y="94" width="200" height="8" as="geometry" />
        </mxCell>
        <mxCell id="7" value="+ getPriority(): int" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="4">
          <mxGeometry y="102" width="200" height="18" as="geometry" />
        </mxCell>
        
        <!-- DriveIdentifier -->
        <mxCell id="8" value="DriveIdentifier" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="100" y="320" width="300" height="200" as="geometry" />
        </mxCell>
        <mxCell id="9" value="- subprocess: Module&#xa;- platform: str" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="8">
          <mxGeometry y="26" width="300" height="44" as="geometry" />
        </mxCell>
        <mxCell id="10" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;" vertex="1" parent="8">
          <mxGeometry y="70" width="300" height="8" as="geometry" />
        </mxCell>
        <mxCell id="11" value="+ get_usb_serial_number(mount_path): str&#xa;+ get_partition_uuid(mount_path): str&#xa;+ get_drive_label(mount_path): str&#xa;+ get_drive_size(mount_path): int&#xa;+ identify_drive(mount_path): DriveInfo&#xa;- _extract_udevadm_serial(output): str&#xa;- _extract_blkid_uuid(output): str" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="8">
          <mxGeometry y="78" width="300" height="122" as="geometry" />
        </mxCell>
        
        <!-- DrivesManager -->
        <mxCell id="12" value="DrivesManager" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="450" y="320" width="350" height="200" as="geometry" />
        </mxCell>
        <mxCell id="13" value="- db_service: ModuleDatabaseService&#xa;- user_id: str&#xa;- drive_identifier: DriveIdentifier&#xa;- drives_cache: dict" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="12">
          <mxGeometry y="26" width="350" height="64" as="geometry" />
        </mxCell>
        <mxCell id="14" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;" vertex="1" parent="12">
          <mxGeometry y="90" width="350" height="8" as="geometry" />
        </mxCell>
        <mxCell id="15" value="+ register_usb_drive(drive_path): dict&#xa;+ get_registered_drives(): list&#xa;+ is_drive_recognized(drive_path): bool&#xa;+ update_drive_status(drive_path, connected): void&#xa;+ discover_current_drives(): list&#xa;+ monitor_drive_changes(): void" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="12">
          <mxGeometry y="98" width="350" height="102" as="geometry" />
        </mxCell>
        
        <!-- Drive Monitor -->
        <mxCell id="16" value="DriveMonitor" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="850" y="320" width="300" height="200" as="geometry" />
        </mxCell>
        <mxCell id="17" value="- event_bus: EventBus&#xa;- drives_manager: DrivesManager&#xa;- polling_interval: int = 5&#xa;- known_drives: set" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="16">
          <mxGeometry y="26" width="300" height="64" as="geometry" />
        </mxCell>
        <mxCell id="18" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;" vertex="1" parent="16">
          <mxGeometry y="90" width="300" height="8" as="geometry" />
        </mxCell>
        <mxCell id="19" value="+ start_monitoring(): void&#xa;+ stop_monitoring(): void&#xa;+ check_drive_changes(): void&#xa;+ emit_drive_added(drive): void&#xa;+ emit_drive_removed(drive): void&#xa;+ emit_drive_status(drives): void" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="16">
          <mxGeometry y="98" width="300" height="102" as="geometry" />
        </mxCell>
        
        <!-- Platform Specific Implementations -->
        <mxCell id="20" value="«abstract»&#xa;PlatformDriveIdentifier" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=40;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#e6e6e6;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="300" y="600" width="250" height="100" as="geometry" />
        </mxCell>
        <mxCell id="21" value="# platform: str" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="20">
          <mxGeometry y="40" width="250" height="24" as="geometry" />
        </mxCell>
        <mxCell id="22" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;" vertex="1" parent="20">
          <mxGeometry y="64" width="250" height="8" as="geometry" />
        </mxCell>
        <mxCell id="23" value="+ get_drive_info(path): DriveInfo" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="20">
          <mxGeometry y="72" width="250" height="28" as="geometry" />
        </mxCell>
        
        <!-- Linux Implementation -->
        <mxCell id="24" value="LinuxDriveIdentifier" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="100" y="750" width="200" height="100" as="geometry" />
        </mxCell>
        <mxCell id="25" value="Uses:&#xa;- udevadm&#xa;- blkid&#xa;- lsusb" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="24">
          <mxGeometry y="26" width="200" height="54" as="geometry" />
        </mxCell>
        <mxCell id="26" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;" vertex="1" parent="24">
          <mxGeometry y="80" width="200" height="8" as="geometry" />
        </mxCell>
        <mxCell id="27" value="+ get_drive_info(): DriveInfo" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="24">
          <mxGeometry y="88" width="200" height="12" as="geometry" />
        </mxCell>
        
        <!-- Windows Implementation -->
        <mxCell id="28" value="WindowsDriveIdentifier" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="350" y="750" width="200" height="100" as="geometry" />
        </mxCell>
        <mxCell id="29" value="Uses:&#xa;- wmic&#xa;- PowerShell&#xa;- Win32 API" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="28">
          <mxGeometry y="26" width="200" height="54" as="geometry" />
        </mxCell>
        <mxCell id="30" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;" vertex="1" parent="28">
          <mxGeometry y="80" width="200" height="8" as="geometry" />
        </mxCell>
        <mxCell id="31" value="+ get_drive_info(): DriveInfo" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="28">
          <mxGeometry y="88" width="200" height="12" as="geometry" />
        </mxCell>
        
        <!-- macOS Implementation -->
        <mxCell id="32" value="MacOSDriveIdentifier" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="600" y="750" width="200" height="100" as="geometry" />
        </mxCell>
        <mxCell id="33" value="Uses:&#xa;- diskutil&#xa;- system_profiler&#xa;- ioreg" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="32">
          <mxGeometry y="26" width="200" height="54" as="geometry" />
        </mxCell>
        <mxCell id="34" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;" vertex="1" parent="32">
          <mxGeometry y="80" width="200" height="8" as="geometry" />
        </mxCell>
        <mxCell id="35" value="+ get_drive_info(): DriveInfo" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="32">
          <mxGeometry y="88" width="200" height="12" as="geometry" />
        </mxCell>
        
        <!-- Relationships -->
        <mxCell id="36" value="uses" style="endArrow=open;endSize=12;dashed=1;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="2" target="4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="37" value="manages" style="endArrow=diamondThin;endFill=1;endSize=16;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="12" target="2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="38" value="uses" style="endArrow=open;endSize=12;dashed=1;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="12" target="8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="39" value="monitors" style="endArrow=open;endSize=12;dashed=1;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="16" target="12">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="40" value="uses" style="endArrow=open;endSize=12;dashed=1;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="8" target="20">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="41" value="" style="endArrow=block;endSize=16;endFill=0;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.25;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="24" target="20">
          <mxGeometry width="160" relative="1" as="geometry" />
        </mxCell>
        <mxCell id="42" value="" style="endArrow=block;endSize=16;endFill=0;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="28" target="20">
          <mxGeometry width="160" relative="1" as="geometry" />
        </mxCell>
        <mxCell id="43" value="" style="endArrow=block;endSize=16;endFill=0;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.75;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="32" target="20">
          <mxGeometry width="160" relative="1" as="geometry" />
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>